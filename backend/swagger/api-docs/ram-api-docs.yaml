  swagger: '2.0'
  info:
    title: RAM Public API
    description: Full documentation of Relationship Access Manager (RAM) public API. All the listed API calls must be prefixed with /api/v1
    version: "1.0.0"
  # the domain of the service
  host: ram.beta.ato.gov.au
  # array of all schemes that your API supports
  schemes:
    - https
  # will be prefixed to all paths
  basePath: /api/v1
  produces:
    - application/json
  paths:
    /roleTypes:
      post:
        summary: Create role type
        operationId: CreateRoleType
        tags:
          - RoleType
        description: |
          creating a new role type
        responses:
          200:   
            description: The newly created role returned back
            schema:
              $ref: "#/definitions/RoleTypeResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
      put:
        operationId: UpdateRoleType
        summary: Update role type
        tags:
          - RoleType
        description: |
          Updating a role type
        responses:
          200:   
            description: The updated role type returned back
            schema:
              $ref: "#/definitions/RoleTypeResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
      get:
        tags:
          - RoleType
        operationId: GetRoleTypes
        summary: Get role types
        description: |
          Returns an array of all role types in RAM.
        responses:
          200:   
            description: Array of all role types in RAM
            schema:
              type: array
              items: 
                $ref: '#/definitions/RoleTypeResponse'
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
    /roleTypes/{roleTypeURI}:
      delete:
        operationId: deleteRoleType
        parameters:
          - name: roleTypeURI
            in: path
            type: string
            required: true
            description: Role type to be deleted
        tags:
          - RoleType
        summary: Delete role type
        description: |
          delete a role type
        responses:
          200:   
            description: Item deleted successfully
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
      get:
        operationId: GetRoleType
        parameters:
          - name: roleTypeURI
            in: path
            type: string
            required: true
            description: Role type URI to be retrieved
        tags:
          - RoleType
        summary: Get a role type by role type URI
        description: Get a role type by role type URI
        responses:
          200:   
            description: Role types in RAM
            schema:
              $ref: '#/definitions/RoleTypeResponse'
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'

    /parties:
      post:
        summary: Create a party 
        description: |
           Generally parties will be created as a side effect of creating a relationship.  
           It is possible that a party may be created independantly of a relationship, 
           e.g. in order to create role properties in preparation of creating relationships.
        
        operationId: CreateParty
        tags:
          - Party
        parameters:
          - name: Party
            in: body
            required: true
            schema:
              $ref: "#/definitions/CreateParty" 
        responses:
          200:   
            description: The updated party returned
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'               
        
    /parties/identities/{idType}/{idValue}/:
      get:
        summary: Get party using identity
        operationId: GetParty
        tags:
          - Party
          - Identity
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
          - name: fields
            in: query
            required: false
            type: array
            collectionFormat: multi
            description: |
              The fields to be retrieved. Each field is in the format of:
              'requestedRoleAttribute.name=:attr-name, :attr-name...'. 
              Possible values are TBD. 
            items:
              type: string                
        responses:
          200:   
            description: The updated party returned
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'                
      delete:
        summary: Delete party using identity
        operationId: DeleteParty
        tags:
          - Party
          - Identity
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"  
        responses:
          200:   
            description: The party deleted successfully
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'                
    /parties/identities/{idType}/{idValue}/roles/:
      post:
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
        summary: Add a role to a party. Party is identified by identity.
        description: | 
           As yet, ther is no identified need for Read or List of Roles as roles are returned from a get 
           against a party (document). 
        operationId: AddPartyRole
        tags:
          - PartyRole
        responses:
          200:   
            description: The updated party returned
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'

    /parties/invidationCode/{invitationCode}:
      get: 
        parameters:
          - name: invitationCode
            type: string
            in: path
            required: true
          - name: fields
            required: false
            description: |
              The fields to be retrieved. Each field is in the format of:
              'requestedRoleAttribute.name=:attr-name, :attr-name...'. 
              Possible values are TBD.
            type: array
            collectionFormat: multi
            in: query
            items:
              type: string
                
        description: | 
          This service may be use to find a party with the specified invitation code (sub type of identity) and update details of that invitation
          code to signal it has been accepted, rejected, etc.  
          If the supplied invitation code details are correct, the status & claimedtimestamp propertie are update.
          The link id for the logged on user is populated into the identity property (together with profile info).
          This identity is used to find a Party record for the logged on user.
          if one is found the Relationship attached to the Party that contains the InvitationCode
          is transfered to the Party identified by the logged on user's Party
          if one isn't found the Identity for the logged on user is attached to the Party that 
          owns the InvitationCode, and thus now the logged on user has a Party record.      
        responses:
          200:   
            description: The updated party returned
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
              
    /parties/identities/{idType}/{idValue}/identity/:
      post:
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
        summary: Add a identity to a party. Party is identified by identity.
        operationId: AddIdentity
        description: |
          In general RAM doesn't create Identity(s) (that is done by the credential service provider, etc),
          but it does create a record of that Identity in its database.  The exception to this is 
          RAM creates InvitationCode(s).  There is no service to create InvitationCode(s) as InvitationCode(s)
          cannot exist independantly of Relationship(s), therefore their creation is a side effect of
          creating a Relationship to an unidentified party.           
        tags:
          - Party
          - Identity
        responses:
          200:   
            description: The updated party returned
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
            
    /parties/identities/{idType}/{idValue}/roles/{roleName}:
      put:
        operationId: UpdatePartyRole
        summary: Update attributes of a role attached to a party. Party is identified by identity.  
        tags:
          - PartyRole
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
          - name: roleName
            in: path
            type: string
            required: true
            description: |
              Role name of which, it s attributes to be updated
        responses:
          200:   
            description: The updated party returned back
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
            
      delete:
        operationId: DeletePartyRole
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
          - name: roleName
            in: path
            type: string
            required: true
            description: Role name to be removed from a party
        tags:
          - PartyRole
        summary: Remove a role from a party
        responses:
          200:   
            description: The updated party returned back
            schema:
              $ref: "#/definitions/PartyResponse"
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
            
    /party/identities/{idType}/{idValue}/relationships/{relType}/parties/identities/{idType}/{idValue}:
      get:
        summary: GetRelationship
        description: |
          This resource identifies a single instance of a relationship.  A get of this resource may be used to confirm the existence  of a relationship between the subject and delegate parties.  The result of a get will be to return details about that relationship including relationship attributes.
        parameters:
          - $ref: "#/parameters/idType"
          - $ref: "#/parameters/idValue"
          - name: relType
            in: path
            description: Type of relationship
            required: true
            type: string
          - name: filter
            in: query
            description: Filtering parameters
            required: false
            type: array
            items:
              type: string
          - name: fields
            in: query
            description: List of fields to be included in the results
            required: false
            type: array
            items:
              type: string
          - name: sort
            in: query
            description: Name of the fields to have the results sorted by
            required: false
            type: string
        tags:
          - Party
        responses:
          200:
            description: A relationship document
            schema:
                $ref: '#/definitions/Relationship'
          400: 
            $ref: '#/responses/400'
          500:
            $ref: '#/responses/500'
  definitions:
      
    PartyResponse:
      type: object
      properties:
        parties:
          type: array
          items:
            $ref: '#/definitions/Party'
          minItems: 1
        roleTypes:
          type: array
          items:
            $ref: '#/definitions/RoleType'
    
    RoleTypeResponse:
      type: object
      properties:
        roleTypes:
          type: array
          items:
            $ref: '#/definitions/RoleType'
            
    Party:
      description: A Party is the concept that participates in Relationships.
      type: object
      properties:
        uri: 
          type: string
          description: URI that uniquely identifying this resource.
        roles:
          type: array
          items:
            $ref: '#/definitions/Role'
        identities:
          type: array
          items:
            $ref: '#/definitions/Identity'
    
    CreateParty:
      description: A Party description to be created.
      type: object
      properties:
        roles:
          type: array
          items:
            $ref: '#/definitions/Role'
        identities:
          type: array
          items:
            $ref: '#/definitions/Identity'

    ProfileProvider:
      description: |
        Profile Provider. TBD        
      type: object
      properties:
        uri: 
          type: string
          description: URI that uniquely identifying this resource.
        code: 
          type: string
          enum: ['self-asserted','mygov','vanguard','auth-app']  
        shortDecodeText:
          type: string
        longDecodeText:
          type: string
        startDate:
          type: string
          description: date in iso format
        endDate:
          type: string
          description: date in iso format
          
    Profile:
      description: |
        A profile is a collection of detail about the party
        A myGov profile consists of Name and Date of Birth
        The CSP may or may not supply the profile.  Not all identities will be supplied by the CSP.  Some profiles may be self asserted.
      type: object
      properties:
        provider:
          $ref: '#/definitions/ProfileProvider'
        name:
          $ref: '#/definitions/Name'
           
    Name:
      type: object
      description: TBD 
      properties:
        givenName:
          type: string
        familyName:
          type: string
        unstructuredName:
          type: string
          
    Identity:
      type: object
      properties:
        profile:
          $ref: '#/definitions/Profile'
             
    Relationship:
      type: object
      properties:
        nickname:
          type: string
        uri: 
          type: string
          description: URI that uniquely identifying this resource.
          
    RoleAttributeValue:
      type: object
      properties:
        name: 
          type: string
          description: Name of an attribute definition
        value:
          type: string
          description: Value assigned to this attribute
            
    RoleAttributeDef:
      type: object
      properties:
        name: 
          type: string
          description: Relationship attribute name. The rest to TBD.
        mandatory:
          type: boolean
          description: should a value to be provided for this attribute
        defaultValue:
          type: string
          description: The default value for this attribute
        acceptedValues:
          description: what are the accepted value types
          type: array
          items:
            type: string     
    Error:
      type: object
      properties:
        status:
          type: integer
          format: int32
          description: HTTP status code
        alert:
          $ref: '#/definitions/Alert'
    Alert:
      type: object
      properties: 
          alertType:            
              type: string
              format: can be one of the following values, success, notice or error 
          messages:
              type: array
              description: Array of string presenting one or more messages 
              items:
                  type: string 
    RoleType:
      type: object
      properties:
        uri: 
          type: string
          description: URI that uniquely identifying this resource.
        name: 
          type: string
          description: |
            A short name for the role type. Must be unique with no space.          
        attributeDefs:
          type: array
          description: Role attributes
          items: 
            $ref: '#/definitions/RoleAttributeDef'
                  
    TBD:
      type: object
      description: Placeholder until defined.
      properties:
        unknown1: 
          type: string
        unknown2: 
          type: string
        unknown3: 
          type: string
        
    Role:
      type: object
      properties:
        roleTypeURI: 
          type: string
          description: Pointing to role type URI
        attributeValues:
          type: array
          items: 
            $ref: '#/definitions/RoleAttributeValue'
          description: Role attributes
        sharing:
          type: array
          description: Agencies which can see existance of this role.
          items:
            $ref: '#/definitions/LegislativeProgram'    
            
    LegislativeProgram:
      description: |
        A LegislativeProgram represents some course-grained grouping of functionality offered by government to citizens. Due to "Machinary of Government" changes these LegislativePrograms are moved between agencies. Generally, LegislativePrograms survive these moves, just in a newly named agency.
      type: object
      properties:
        uri: 
          type: string
          description: URI that uniquely identifying this resource.
        name: 
          type: string
          description: |
            Name of legislative program.

  parameters:
    idType:
      name: idType
      in: path
      description: Type of identity resolver, possible values are [abn, acn, etc.]
      required: true
      type: string
    idValue:
      name: idValue
      in: path
      description: identity value that can be used by identity resolver 
      required: true
      type: string        

  responses:
    400:
      description: Bad Input Error 
      schema:
        $ref: '#/definitions/Error'
    500:
      description: Server Error
      schema:
        $ref: '#/definitions/Error'
